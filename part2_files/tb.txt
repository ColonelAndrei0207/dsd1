`timescale 1ns/10ps

/*
 * Describes how the test will turn out
 * In essence we generate the clock, perform a reset, and wait for the program memory to run out of instructions
 * 
 * TODO: add clever solutions to reduce the simulation time (if's to stop faster if a 'HALT' is detected)
 */

module processor_tb();

localparam baud_rate = 10000; //baud rate will be set based on the configured AXILite IP baud rate

localparam baud-edge = baud_rate/2;

localparam parity_bit = 0 //set as 0 if no parity bit is configured

//TODO: extra parameters for the read/write byte tasks

    logic tx;
    logic rx;
    logic interrupt;

    fpga DUT (

    .sys_clk_i(clk),
	.sys_reset_n_i(rst),
	
	//connections with the PC
	.rx_i(rx),
	.tx_o(tx),
	.interrupt_o(interrupt)
    
    );

	initial begin

		clk = 0;

		forever begin
			#5 clk = ~clk;
		end
	end


	initial begin
		rst = 1;
		#10;
		rst = 0;
		#10;
		rst = 1;
		
//start of task call

		#450;

		$finish;

	end


endmodule

/* write_byte task
task description:
it will get as input the data byte, and transform the byte into a UART friendly tx signal;
TODO: revise UART protocol to ensure proper sending of data
*/
task write_byte(int data_byte);

   tx = 1;
   #2;
   tx = 0; //start bit
   #(baud_edge)
   for (int i =0; i <8; i++) begin

      tx = data_byte[i];
      #(baud_edge);

   end

endtask


/* read_byte task
task description: 
it will make sure that the data received on rx
*/

task read_byte();


endtask
